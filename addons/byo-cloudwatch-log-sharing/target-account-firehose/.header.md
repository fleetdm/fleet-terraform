# Fleet CloudWatch Log Group Sharing via Firehose (Target Account)

This module creates the cross-account CloudWatch Logs destination and a Firehose delivery stream target.

CloudWatch Logs subscription payloads are already gzip-compressed. This module defaults Firehose `compression_format` to `UNCOMPRESSED` to avoid double-compression.

Because CloudWatch Logs destinations must be created in the same region as the source log group, this module uses two provider aliases:

- `aws.destination`: Region of the Fleet CloudWatch log group (source region).
- `aws.target`: Region for the Firehose stream and S3 bucket (same region or different region).

## Usage

```hcl
provider "aws" {
  alias  = "source_region"
  region = "us-east-2"
}

provider "aws" {
  alias  = "target_region"
  region = "us-west-2"
}

module "fleet_log_sharing_target" {
  source = "github.com/fleetdm/fleet-terraform//addons/byo-cloudwatch-log-sharing/target-account-firehose?depth=1&ref=tf-mod-addon-byo-cloudwatch-log-sharing-v1.0.0"

  providers = {
    aws.destination = aws.source_region
    aws.target      = aws.target_region
  }

  source_account_ids = ["111111111111"]

  cloudwatch_destination = {
    name        = "fleet-app-logs-firehose"
    role_name   = "fleet-app-logs-destination-role"
    policy_name = "fleet-app-logs-destination-policy"
  }

  firehose = {
    delivery_stream_name = "fleet-app-logs-firehose"
    role_name            = "fleet-app-logs-firehose-role"
    policy_name          = "fleet-app-logs-firehose-policy"
    # Optional override; default is UNCOMPRESSED.
    compression_format   = "UNCOMPRESSED"
  }

  s3 = {
    bucket_name = "fleet-app-logs-firehose-example"
  }
}

output "fleet_log_sharing_target" {
  value = module.fleet_log_sharing_target
}
```

Then apply the source account module (`../cloudwatch`) using `module.fleet_log_sharing_target.log_destination.arn` (default `destination_type` is `firehose`).
